<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>GDS - Generic Data Structures: tokenizer.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.2 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Compound&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Compound&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<h1>tokenizer.c</h1><a href="tokenizer_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">// =================================================================</span>
00002 <span class="comment">// @(#)tokenizer.c</span>
00003 <span class="comment">//</span>
00004 <span class="comment">// @author Bruno Quoitin (bqu@infonet.fundp.ac.be)</span>
00005 <span class="comment">// @date 10/07/2003</span>
00006 <span class="comment">// @lastdate 25/07/2003</span>
00007 <span class="comment">// =================================================================</span>
00008 
00009 <span class="preprocessor">#include &lt;assert.h&gt;</span>
00010 <span class="preprocessor">#include &lt;<a class="code" href="memory_8h.html">memory.h</a>&gt;</span>
00011 <span class="preprocessor">#include &lt;<a class="code" href="tokenizer_8h.html">tokenizer.h</a>&gt;</span>
00012 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
00013 <span class="preprocessor">#include &lt;string.h&gt;</span>
00014 <span class="preprocessor">#include &lt;<a class="code" href="str__util_8h.html">str_util.h</a>&gt;</span>
00015 
<a name="l00016"></a><a class="code" href="tokenizer_8c.html#a0">00016</a> <span class="preprocessor">#define TOKENIZER_BUFFER_SIZE 1024</span>
00017 <span class="preprocessor"></span>
<a name="l00018"></a><a class="code" href="tokenizer_8c.html#a1">00018</a> <span class="preprocessor">#define TOKENIZER_STATE_NORMAL 0</span>
<a name="l00019"></a><a class="code" href="tokenizer_8c.html#a2">00019</a> <span class="preprocessor"></span><span class="preprocessor">#define TOKENIZER_STATE_DELIM  1</span>
<a name="l00020"></a><a class="code" href="tokenizer_8c.html#a3">00020</a> <span class="preprocessor"></span><span class="preprocessor">#define TOKENIZER_STATE_QUOTED 2</span>
00021 <span class="preprocessor"></span>
<a name="l00022"></a><a class="code" href="tokenizer_8c.html#a4">00022</a> <span class="preprocessor">#define TOKENIZER_SUCCESS          0</span>
<a name="l00023"></a><a class="code" href="tokenizer_8c.html#a5">00023</a> <span class="preprocessor"></span><span class="preprocessor">#define TOKENIZER_ERROR_UNEXPECTED -1</span>
<a name="l00024"></a><a class="code" href="tokenizer_8c.html#a6">00024</a> <span class="preprocessor"></span><span class="preprocessor">#define TOKENIZER_ERROR_OPEN_BLOCK -2</span>
<a name="l00025"></a><a class="code" href="tokenizer_8c.html#a7">00025</a> <span class="preprocessor"></span><span class="preprocessor">#define TOKENIZER_ERROR_ESCAPE     -3</span>
00026 <span class="preprocessor"></span>
00027 <span class="comment">// ----- tokens_item_destroy ----------------------------------------</span>
<a name="l00028"></a><a class="code" href="tokenizer_8c.html#a8">00028</a> <span class="keywordtype">void</span> <a class="code" href="tokenizer_8c.html#a8">tokens_item_destroy</a>(<span class="keywordtype">void</span> * pItem)
00029 {
00030   <a class="code" href="str__util_8c.html#a4">str_destroy</a>((<span class="keywordtype">char</span> **) pItem);
00031 }
00032 
00033 <span class="comment">// ----- tokens_create ----------------------------------------------</span>
<a name="l00037"></a><a class="code" href="tokenizer_8c.html#a9">00037</a> <span class="comment"></span><a class="code" href="structSPtrArray.html">STokens</a> * <a class="code" href="tokenizer_8c.html#a9">tokens_create</a>()
00038 {
00039   <span class="keywordflow">return</span> (<a class="code" href="structSPtrArray.html">STokens</a> *) <a class="code" href="array_8h.html#a12">ptr_array_create</a>(0, NULL, <a class="code" href="tokenizer_8c.html#a8">tokens_item_destroy</a>);
00040 }
00041 
00042 <span class="comment">// ----- tokens_destroy ---------------------------------------------</span>
<a name="l00046"></a><a class="code" href="tokenizer_8c.html#a10">00046</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="tokenizer_8c.html#a10">tokens_destroy</a>(<a class="code" href="structSPtrArray.html">STokens</a> ** ppTokens)
00047 {
00048   <a class="code" href="array_8h.html#a13">ptr_array_destroy</a>((<a class="code" href="structSPtrArray.html">SPtrArray</a> **) ppTokens);
00049 }
00050 
00051 <span class="comment">// ----- tokens_add -------------------------------------------------</span>
<a name="l00055"></a><a class="code" href="tokenizer_8c.html#a11">00055</a> <span class="comment"></span><span class="keywordtype">int</span> <a class="code" href="tokenizer_8c.html#a11">tokens_add</a>(<a class="code" href="structSPtrArray.html">STokens</a> * pTokens, <span class="keywordtype">char</span> * pcToken)
00056 {
00057   <span class="keywordflow">return</span> <a class="code" href="array_8h.html#a17">ptr_array_add</a>((<a class="code" href="structSPtrArray.html">SPtrArray</a> *) pTokens, &amp;pcToken);
00058 }
00059 
00060 <span class="comment">// ----- tokens_add_copy --------------------------------------------</span>
<a name="l00064"></a><a class="code" href="tokenizer_8c.html#a12">00064</a> <span class="comment"></span><span class="keywordtype">int</span> <a class="code" href="tokenizer_8c.html#a12">tokens_add_copy</a>(<a class="code" href="structSPtrArray.html">STokens</a> * pTokens, <span class="keywordtype">char</span> * pcToken)
00065 {
00066   <span class="keywordtype">char</span> * pcTokenCopy= <a class="code" href="str__util_8c.html#a1">str_create</a>(pcToken);
00067   <span class="keywordflow">return</span> <a class="code" href="array_8h.html#a17">ptr_array_add</a>((<a class="code" href="structSPtrArray.html">SPtrArray</a> *) pTokens, &amp;pcTokenCopy);
00068 }
00069 
00070 <span class="comment">// ----- tokens_get_num ---------------------------------------------</span>
<a name="l00074"></a><a class="code" href="tokenizer_8c.html#a13">00074</a> <span class="comment"></span><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="tokenizer_8c.html#a13">tokens_get_num</a>(<a class="code" href="structSPtrArray.html">STokens</a> * pTokens)
00075 {
00076   <span class="keywordflow">return</span> <a class="code" href="array_8h.html#a14">ptr_array_length</a>((<a class="code" href="structSPtrArray.html">SPtrArray</a> *) pTokens);
00077 }
00078 
00079 <span class="comment">// ----- tokens_get_string_at ---------------------------------------</span>
<a name="l00083"></a><a class="code" href="tokenizer_8c.html#a14">00083</a> <span class="comment"></span><span class="keywordtype">char</span> * <a class="code" href="tokenizer_8c.html#a14">tokens_get_string_at</a>(<a class="code" href="structSPtrArray.html">STokens</a> * pTokens, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> uIndex)
00084 {
00085   <span class="keywordflow">if</span> (uIndex &lt; <a class="code" href="tokenizer_8c.html#a13">tokens_get_num</a>(pTokens))
00086     <span class="keywordflow">return</span> (<span class="keywordtype">char</span> *) pTokens-&gt;<a class="code" href="structSPtrArray.html#o0">data</a>[uIndex];
00087   <span class="keywordflow">return</span> NULL;
00088 }
00089 
00090 <span class="comment">// ----- tokens_get_integer_at --------------------------------------</span>
<a name="l00094"></a><a class="code" href="tokenizer_8c.html#a15">00094</a> <span class="comment"></span><span class="keywordtype">int</span> <a class="code" href="tokenizer_8c.html#a15">tokens_get_integer_at</a>(<a class="code" href="structSPtrArray.html">STokens</a> * pTokens, uint16_t uIndex,
00095                           <span class="keywordtype">long</span> <span class="keywordtype">int</span> * plValue)
00096 {
00097   <span class="keywordtype">long</span> <span class="keywordtype">int</span> lValue;
00098   <span class="keywordtype">char</span> * pcValue;
00099   <span class="keywordtype">char</span> * pcEndPtr;
00100 
00101   <span class="keywordflow">if</span> (plValue == NULL)
00102     <span class="keywordflow">return</span> -1;
00103   <span class="keywordflow">if</span> (uIndex &lt; <a class="code" href="tokenizer_8c.html#a13">tokens_get_num</a>(pTokens)) {
00104     pcValue= pTokens-&gt;<a class="code" href="structSPtrArray.html#o0">data</a>[uIndex];
00105     lValue= strtol(pcValue, &amp;pcEndPtr, 0);
00106     *plValue= lValue;
00107     <span class="keywordflow">return</span> (*pcEndPtr == 0)?0:-1;
00108   }
00109   <span class="keywordflow">return</span> -1;
00110 }
00111 
00112 <span class="comment">// ----- tokens_get_unsigned_at -------------------------------------</span>
<a name="l00116"></a><a class="code" href="tokenizer_8c.html#a16">00116</a> <span class="comment"></span><span class="keywordtype">int</span> <a class="code" href="tokenizer_8c.html#a16">tokens_get_unsigned_at</a>(<a class="code" href="structSPtrArray.html">STokens</a> * pTokens, uint16_t uIndex,
00117                            <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> * plValue)
00118 {
00119   <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> lValue;
00120   <span class="keywordtype">char</span> * pcValue;
00121   <span class="keywordtype">char</span> * pcEndPtr;
00122 
00123   <span class="keywordflow">if</span> (plValue == NULL)
00124     <span class="keywordflow">return</span> -1;
00125   <span class="keywordflow">if</span> (uIndex &lt; <a class="code" href="tokenizer_8c.html#a13">tokens_get_num</a>(pTokens)) {
00126     pcValue= pTokens-&gt;<a class="code" href="structSPtrArray.html#o0">data</a>[uIndex];
00127     lValue= strtoul(pcValue, &amp;pcEndPtr, 0);
00128     *plValue= lValue;
00129     <span class="keywordflow">return</span> (*pcEndPtr == 0)?0:-1;
00130   }
00131   <span class="keywordflow">return</span> -1;
00132 }
00133 
00134 <span class="comment">// ----- tokens_get_double_at ---------------------------------------</span>
<a name="l00138"></a><a class="code" href="tokenizer_8c.html#a17">00138</a> <span class="comment"></span><span class="keywordtype">int</span> <a class="code" href="tokenizer_8c.html#a17">tokens_get_double_at</a>(<a class="code" href="structSPtrArray.html">STokens</a> * pTokens, uint16_t uIndex,
00139                          <span class="keywordtype">double</span> * pdValue)
00140 {
00141   <span class="keywordtype">double</span> dValue;
00142   <span class="keywordtype">char</span> * pcValue;
00143   <span class="keywordtype">char</span> * pcEndPtr;
00144 
00145   <span class="keywordflow">if</span> (pdValue == NULL)
00146     <span class="keywordflow">return</span> -1;
00147   <span class="keywordflow">if</span> (uIndex &lt; <a class="code" href="tokenizer_8c.html#a13">tokens_get_num</a>(pTokens)) {
00148     pcValue= pTokens-&gt;<a class="code" href="structSPtrArray.html#o0">data</a>[uIndex];
00149     dValue= strtod(pcValue, &amp;pcEndPtr);
00150     *pdValue= dValue;
00151     <span class="keywordflow">return</span> (*pcEndPtr == 0)?0:-1;
00152   }
00153   <span class="keywordflow">return</span> -1;
00154 }
00155 
00156 <span class="comment">// ----- tokenizer_create -------------------------------------------</span>
<a name="l00160"></a><a class="code" href="tokenizer_8c.html#a18">00160</a> <span class="comment"></span><a class="code" href="structSTokenizer.html">STokenizer</a> * <a class="code" href="tokenizer_8c.html#a18">tokenizer_create</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> * pcDelimiters,
00161                               <span class="keyword">const</span> <span class="keywordtype">char</span> * pcOpeningQuotes,
00162                               <span class="keyword">const</span> <span class="keywordtype">char</span> * pcClosingQuotes)
00163 {
00164   <a class="code" href="structSTokenizer.html">STokenizer</a> * pTokenizer=
00165     (<a class="code" href="structSTokenizer.html">STokenizer</a> *) <a class="code" href="memory_8h.html#a0">MALLOC</a>(<span class="keyword">sizeof</span>(<a class="code" href="structSTokenizer.html">STokenizer</a>));
00166   pTokenizer-&gt;<a class="code" href="structSTokenizer.html#o0">pTokens</a>= NULL;
00167   pTokenizer-&gt;<a class="code" href="structSTokenizer.html#o1">pcDelimiters</a>= <a class="code" href="str__util_8c.html#a1">str_create</a>(pcDelimiters);
00168   <span class="keywordflow">if</span> ((pcOpeningQuotes != NULL) &amp;&amp; (pcClosingQuotes != NULL)) {
00169     assert(strlen(pcOpeningQuotes) == strlen(pcClosingQuotes));
00170     pTokenizer-&gt;<a class="code" href="structSTokenizer.html#o2">pcOpeningQuotes</a>= <a class="code" href="str__util_8c.html#a1">str_create</a>(pcOpeningQuotes);
00171     pTokenizer-&gt;<a class="code" href="structSTokenizer.html#o3">pcClosingQuotes</a>= <a class="code" href="str__util_8c.html#a1">str_create</a>(pcClosingQuotes);
00172   } <span class="keywordflow">else</span> {
00173     pTokenizer-&gt;<a class="code" href="structSTokenizer.html#o2">pcOpeningQuotes</a>= NULL;
00174     pTokenizer-&gt;<a class="code" href="structSTokenizer.html#o3">pcClosingQuotes</a>= NULL;
00175   }
00176   <span class="keywordflow">return</span> pTokenizer;
00177 }
00178 
00179 <span class="comment">// ----- tokenizer_destroy ------------------------------------------</span>
<a name="l00183"></a><a class="code" href="tokenizer_8c.html#a19">00183</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="tokenizer_8c.html#a19">tokenizer_destroy</a>(<a class="code" href="structSTokenizer.html">STokenizer</a> ** ppTokenizer)
00184 {
00185   <span class="keywordflow">if</span> (*ppTokenizer != NULL) {
00186     <a class="code" href="str__util_8c.html#a4">str_destroy</a>(&amp;(*ppTokenizer)-&gt;pcDelimiters);
00187     <a class="code" href="str__util_8c.html#a4">str_destroy</a>(&amp;(*ppTokenizer)-&gt;pcOpeningQuotes);
00188     <a class="code" href="str__util_8c.html#a4">str_destroy</a>(&amp;(*ppTokenizer)-&gt;pcClosingQuotes);
00189     <a class="code" href="tokenizer_8c.html#a10">tokens_destroy</a>(&amp;(*ppTokenizer)-&gt;pTokens);
00190     <a class="code" href="memory_8h.html#a2">FREE</a>(*ppTokenizer);
00191     *ppTokenizer= NULL;
00192   }
00193 }
00194 
00195 <span class="comment">// ----- tokenizer_get_tokens ---------------------------------------</span>
<a name="l00199"></a><a class="code" href="tokenizer_8c.html#a20">00199</a> <span class="comment"></span><a class="code" href="structSPtrArray.html">STokens</a> * <a class="code" href="tokenizer_8c.html#a20">tokenizer_get_tokens</a>(<a class="code" href="structSTokenizer.html">STokenizer</a> * pTokenizer)
00200 {
00201   <span class="keywordflow">return</span> pTokenizer-&gt;<a class="code" href="structSTokenizer.html#o0">pTokens</a>;
00202 }
00203 
00204 <span class="comment">// ----- tokenizer_run ----------------------------------------------</span>
<a name="l00208"></a><a class="code" href="tokenizer_8c.html#a21">00208</a> <span class="comment"></span><span class="keywordtype">int</span> <a class="code" href="tokenizer_8c.html#a21">tokenizer_run</a>(<a class="code" href="structSTokenizer.html">STokenizer</a> * pTokenizer, <span class="keywordtype">char</span> * pcString)
00209 {
00210   <span class="keywordtype">int</span> iResult= <a class="code" href="tokenizer_8c.html#a5">TOKENIZER_ERROR_UNEXPECTED</a>;
00211   <span class="keywordtype">char</span> cClosingQuote= <span class="charliteral">'\0'</span>;
00212   <span class="keywordtype">int</span> iState= <a class="code" href="tokenizer_8c.html#a1">TOKENIZER_STATE_NORMAL</a>;
00213   <span class="keywordtype">char</span> cCtrlChar, cDataChar;
00214   <span class="keywordtype">char</span> * pcTokenBuffer= NULL;
00215   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> uTokenBufferPos= 0;
00216   size_t tTokenBufferSize= <a class="code" href="tokenizer_8c.html#a0">TOKENIZER_BUFFER_SIZE</a>;
00217   <span class="keywordtype">int</span> iTokenReady= 0;
00218   <span class="keywordtype">char</span> * pcQuote;
00219 
00220   <span class="comment">// Free old list of tokens</span>
00221   <span class="keywordflow">if</span> (pTokenizer-&gt;<a class="code" href="structSTokenizer.html#o0">pTokens</a> != NULL)
00222     <a class="code" href="tokenizer_8c.html#a10">tokens_destroy</a>(&amp;pTokenizer-&gt;<a class="code" href="structSTokenizer.html#o0">pTokens</a>);
00223   <span class="comment">// Allocate new one</span>
00224   pTokenizer-&gt;<a class="code" href="structSTokenizer.html#o0">pTokens</a>= <a class="code" href="tokenizer_8c.html#a9">tokens_create</a>();
00225 
00226   <span class="comment">// Allocate token buffer</span>
00227   pcTokenBuffer= <a class="code" href="str__util_8c.html#a0">str_lcreate</a>(tTokenBufferSize);
00228 
00229   <span class="comment">// Finite State Machine</span>
00230   <span class="keywordflow">while</span> (iResult == <a class="code" href="tokenizer_8c.html#a5">TOKENIZER_ERROR_UNEXPECTED</a>) {
00231     <span class="comment">// Eat one char</span>
00232     cCtrlChar= *(pcString++);
00233     <span class="comment">// Process escaped-characters</span>
00234     <span class="keywordflow">if</span> (cCtrlChar == <span class="charliteral">'\\'</span>) {
00235       <span class="keywordflow">if</span> (*pcString == <span class="charliteral">'\0'</span>) {
00236         iResult= <a class="code" href="tokenizer_8c.html#a7">TOKENIZER_ERROR_ESCAPE</a>;
00237         <span class="keywordflow">break</span>;
00238       }
00239       cDataChar= *(pcString++);
00240     } <span class="keywordflow">else</span>
00241       cDataChar= cCtrlChar;
00242     <span class="comment">// State-dependent actions</span>
00243     <span class="keywordflow">switch</span> (iState) {
00244     <span class="keywordflow">case</span> <a class="code" href="tokenizer_8c.html#a1">TOKENIZER_STATE_NORMAL</a>:
00245       <span class="keywordflow">if</span> ((cCtrlChar == <span class="charliteral">'\0'</span>) || (cCtrlChar == <span class="charliteral">'\n'</span>)) {
00246         iResult= <a class="code" href="tokenizer_8c.html#a4">TOKENIZER_SUCCESS</a>;
00247         <span class="keywordflow">if</span> (iTokenReady) {
00248           pcTokenBuffer[uTokenBufferPos]= <span class="charliteral">'\0'</span>;
00249           <a class="code" href="tokenizer_8c.html#a12">tokens_add_copy</a>(pTokenizer-&gt;<a class="code" href="structSTokenizer.html#o0">pTokens</a>, pcTokenBuffer);
00250           uTokenBufferPos= 0;
00251           pcTokenBuffer[0]= <span class="charliteral">'\0'</span>;
00252           iTokenReady= 0;
00253         }
00254       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strchr(pTokenizer-&gt;<a class="code" href="structSTokenizer.html#o1">pcDelimiters</a>, cCtrlChar) != NULL) {
00255         iState= <a class="code" href="tokenizer_8c.html#a2">TOKENIZER_STATE_DELIM</a>;
00256         <span class="keywordflow">if</span> (iTokenReady) {
00257           pcTokenBuffer[uTokenBufferPos]= <span class="charliteral">'\0'</span>;
00258           <a class="code" href="tokenizer_8c.html#a12">tokens_add_copy</a>(pTokenizer-&gt;<a class="code" href="structSTokenizer.html#o0">pTokens</a>, pcTokenBuffer);
00259           uTokenBufferPos= 0;
00260           pcTokenBuffer[0]= <span class="charliteral">'\0'</span>;
00261           iTokenReady= 0;
00262         }
00263       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((pcQuote= strchr(pTokenizer-&gt;<a class="code" href="structSTokenizer.html#o2">pcOpeningQuotes</a>, cCtrlChar))
00264                  != NULL) {
00265         iState= <a class="code" href="tokenizer_8c.html#a3">TOKENIZER_STATE_QUOTED</a>;
00266         cClosingQuote= *(pTokenizer-&gt;<a class="code" href="structSTokenizer.html#o3">pcClosingQuotes</a>+
00267                          (pcQuote-pTokenizer-&gt;<a class="code" href="structSTokenizer.html#o2">pcOpeningQuotes</a>));
00268       } <span class="keywordflow">else</span> {
00269         <span class="comment">// Store char in token-buffer</span>
00270         pcTokenBuffer[uTokenBufferPos++]= cDataChar;
00271         iTokenReady= 1;
00272       }
00273       <span class="keywordflow">break</span>;
00274     <span class="keywordflow">case</span> <a class="code" href="tokenizer_8c.html#a2">TOKENIZER_STATE_DELIM</a>:
00275       <span class="keywordflow">if</span> ((cCtrlChar == <span class="charliteral">'\0'</span>) || (cCtrlChar == <span class="charliteral">'\n'</span>)) {
00276         iResult= <a class="code" href="tokenizer_8c.html#a4">TOKENIZER_SUCCESS</a>;
00277       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((pcQuote= strchr(pTokenizer-&gt;<a class="code" href="structSTokenizer.html#o2">pcOpeningQuotes</a>, cCtrlChar))
00278                  != NULL) {
00279         iState= <a class="code" href="tokenizer_8c.html#a3">TOKENIZER_STATE_QUOTED</a>;
00280         cClosingQuote= *(pTokenizer-&gt;<a class="code" href="structSTokenizer.html#o3">pcClosingQuotes</a>+
00281                          (pcQuote-pTokenizer-&gt;<a class="code" href="structSTokenizer.html#o2">pcOpeningQuotes</a>));
00282       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strchr(pTokenizer-&gt;<a class="code" href="structSTokenizer.html#o1">pcDelimiters</a>, cCtrlChar) == NULL) {
00283         iState= <a class="code" href="tokenizer_8c.html#a1">TOKENIZER_STATE_NORMAL</a>;
00284         pcTokenBuffer[uTokenBufferPos++]= cDataChar;
00285         iTokenReady= 1;
00286       }
00287       <span class="keywordflow">break</span>;
00288     <span class="keywordflow">case</span> <a class="code" href="tokenizer_8c.html#a3">TOKENIZER_STATE_QUOTED</a>:
00289       iTokenReady= 1;
00290       <span class="keywordflow">if</span> (cCtrlChar == <span class="charliteral">'\0'</span>) {
00291         iResult= <a class="code" href="tokenizer_8c.html#a6">TOKENIZER_ERROR_OPEN_BLOCK</a>;
00292       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cCtrlChar == cClosingQuote) {
00293         iState= <a class="code" href="tokenizer_8c.html#a1">TOKENIZER_STATE_NORMAL</a>;
00294       } <span class="keywordflow">else</span> {
00295         pcTokenBuffer[uTokenBufferPos++]= cDataChar;
00296       }
00297       <span class="keywordflow">break</span>;
00298     }
00299   }
00300   <span class="keywordflow">if</span> (iResult == <a class="code" href="tokenizer_8c.html#a4">TOKENIZER_SUCCESS</a>) {
00301     <span class="keywordflow">if</span> (iState == <a class="code" href="tokenizer_8c.html#a3">TOKENIZER_STATE_QUOTED</a>)
00302       iResult= <a class="code" href="tokenizer_8c.html#a6">TOKENIZER_ERROR_OPEN_BLOCK</a>;
00303   }
00304   <a class="code" href="str__util_8c.html#a4">str_destroy</a>(&amp;pcTokenBuffer);
00305   <span class="keywordflow">return</span> iResult;
00306 }
00307 
00308 <span class="comment">// ----- tokenizer_perror -------------------------------------------</span>
<a name="l00312"></a><a class="code" href="tokenizer_8c.html#a22">00312</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="tokenizer_8c.html#a22">tokenizer_perror</a>(FILE * pStream, <span class="keywordtype">int</span> iErrorCode)
00313 {
00314   <span class="keywordflow">switch</span> (iErrorCode) {
00315   <span class="keywordflow">case</span> <a class="code" href="tokenizer_8c.html#a4">TOKENIZER_SUCCESS</a>:
00316     fprintf(pStream, <span class="stringliteral">"success\n"</span>); <span class="keywordflow">break</span>;
00317   <span class="keywordflow">case</span> <a class="code" href="tokenizer_8c.html#a5">TOKENIZER_ERROR_UNEXPECTED</a>:
00318     fprintf(pStream, <span class="stringliteral">"unexpected error\n"</span>); <span class="keywordflow">break</span>;
00319   <span class="keywordflow">case</span> <a class="code" href="tokenizer_8c.html#a6">TOKENIZER_ERROR_OPEN_BLOCK</a>:
00320     fprintf(pStream, <span class="stringliteral">"open quoted block\n"</span>); <span class="keywordflow">break</span>;
00321   <span class="keywordflow">case</span> <a class="code" href="tokenizer_8c.html#a7">TOKENIZER_ERROR_ESCAPE</a>:
00322     fprintf(pStream, <span class="stringliteral">"incomplete escaped-character\n"</span>); <span class="keywordflow">break</span>;
00323   <span class="keywordflow">default</span>:
00324     fprintf(pStream, <span class="stringliteral">"unknown error\n"</span>); <span class="keywordflow">break</span>;
00325   }
00326 }
00327 
00328 <span class="comment">// ----- tokenizer_get_num_token ------------------------------------</span>
<a name="l00332"></a><a class="code" href="tokenizer_8c.html#a23">00332</a> <span class="comment"></span>uint16_t <a class="code" href="tokenizer_8c.html#a23">tokenizer_get_num_tokens</a>(<a class="code" href="structSTokenizer.html">STokenizer</a> * pTokenizer)
00333 {
00334   <span class="keywordflow">if</span> (pTokenizer-&gt;<a class="code" href="structSTokenizer.html#o0">pTokens</a> != NULL)
00335     <span class="keywordflow">return</span> <a class="code" href="tokenizer_8c.html#a13">tokens_get_num</a>(pTokenizer-&gt;<a class="code" href="structSTokenizer.html#o0">pTokens</a>);
00336   <span class="keywordflow">else</span>
00337     <span class="keywordflow">return</span> 0;
00338 }
00339 
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Wed Jul 30 15:56:48 2003 for GDS - Generic Data Structures by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.2 </small></address>
</body>
</html>
