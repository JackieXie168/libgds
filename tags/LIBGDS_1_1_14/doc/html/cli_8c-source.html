<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>GDS - Generic Data Structures: cli.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.2 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Compound&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Compound&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<h1>cli.c</h1><a href="cli_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">// ==================================================================</span>
00002 <span class="comment">// @(#)cli.c</span>
00003 <span class="comment">//</span>
00004 <span class="comment">// @author Bruno Quoitin (bqu@infonet.fundp.ac.be)</span>
00005 <span class="comment">// @date 25/06/2003</span>
00006 <span class="comment">// @lastdate 29/07/2003</span>
00007 <span class="comment">// ==================================================================</span>
00008 
00009 <span class="preprocessor">#include &lt;assert.h&gt;</span>
00010 <span class="preprocessor">#include &lt;<a class="code" href="cli_8h.html">cli.h</a>&gt;</span>
00011 <span class="preprocessor">#include &lt;<a class="code" href="cli__ctx_8h.html">cli_ctx.h</a>&gt;</span>
00012 <span class="preprocessor">#include &lt;<a class="code" href="memory_8h.html">memory.h</a>&gt;</span>
00013 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
00014 <span class="preprocessor">#include &lt;string.h&gt;</span>
00015 
<a name="l00016"></a><a class="code" href="cli_8c.html#a0">00016</a> <span class="preprocessor">#define CLI_DELIMITERS " \t"</span>
<a name="l00017"></a><a class="code" href="cli_8c.html#a1">00017</a> <span class="preprocessor"></span><span class="preprocessor">#define CLI_OPENING_QUOTES "\""</span>
<a name="l00018"></a><a class="code" href="cli_8c.html#a2">00018</a> <span class="preprocessor"></span><span class="preprocessor">#define CLI_CLOSING_QUOTES "\""</span>
00019 <span class="preprocessor"></span>
00020 <span class="comment">// ----- cli_cmd_param_create ---------------------------------------</span>
<a name="l00024"></a><a class="code" href="cli_8c.html#a3">00024</a> <span class="comment"></span><a class="code" href="structSCliCmdParam.html">SCliCmdParam</a> * <a class="code" href="cli_8c.html#a3">cli_cmd_param_create</a>(<span class="keywordtype">char</span> * pcName,
00025                                     FCliCheckParam fCheckParam)
00026 {
00027   <a class="code" href="structSCliCmdParam.html">SCliCmdParam</a> * pParam= (<a class="code" href="structSCliCmdParam.html">SCliCmdParam</a> *) <a class="code" href="memory_8h.html#a0">MALLOC</a>(<span class="keyword">sizeof</span>(<a class="code" href="structSCliCmdParam.html">SCliCmdParam</a>));
00028 
00029   pParam-&gt;<a class="code" href="structSCliCmdParam.html#o0">pcName</a>= (<span class="keywordtype">char</span> *) <a class="code" href="memory_8h.html#a0">MALLOC</a>(<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>)*(strlen(pcName)+1));
00030   strcpy(pParam-&gt;<a class="code" href="structSCliCmdParam.html#o0">pcName</a>, pcName);
00031   pParam-&gt;<a class="code" href="structSCliCmdParam.html#o1">fCheckParam</a>= fCheckParam;
00032   <span class="keywordflow">return</span> pParam;
00033 }
00034 
00035 <span class="comment">// ----- cli_cmd_param_destroy --------------------------------------</span>
<a name="l00039"></a><a class="code" href="cli_8c.html#a4">00039</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="cli_8c.html#a4">cli_cmd_param_destroy</a>(<a class="code" href="structSCliCmdParam.html">SCliCmdParam</a> ** ppParam)
00040 {
00041   <span class="keywordflow">if</span> (*ppParam != NULL) {
00042     <a class="code" href="memory_8h.html#a2">FREE</a>((*ppParam)-&gt;pcName);
00043     <a class="code" href="memory_8h.html#a2">FREE</a>(*ppParam);
00044     *ppParam= NULL;
00045   }
00046 }
00047 
00048 <span class="comment">// ----- cli_params_item_compare ------------------------------------</span>
<a name="l00049"></a><a class="code" href="cli_8c.html#a5">00049</a> <span class="keywordtype">int</span> <a class="code" href="cli_8c.html#a5">cli_params_item_compare</a>(<span class="keywordtype">void</span> * pItem1, <span class="keywordtype">void</span> * pItem2,
00050                             uint32_t uEltSize)
00051 {
00052   <a class="code" href="structSCliCmdParam.html">SCliCmdParam</a> * pParam1= *((<a class="code" href="structSCliCmdParam.html">SCliCmdParam</a> **) pItem1);
00053   <a class="code" href="structSCliCmdParam.html">SCliCmdParam</a> * pParam2= *((<a class="code" href="structSCliCmdParam.html">SCliCmdParam</a> **) pItem2);
00054 
00055   <span class="keywordflow">return</span> strcmp(pParam1-&gt;<a class="code" href="structSCliCmdParam.html#o0">pcName</a>, pParam2-&gt;<a class="code" href="structSCliCmdParam.html#o0">pcName</a>);
00056 }
00057 
00058 <span class="comment">// ----- cli_params_item_destroy ------------------------------------</span>
<a name="l00059"></a><a class="code" href="cli_8c.html#a6">00059</a> <span class="keywordtype">void</span> <a class="code" href="cli_8c.html#a6">cli_params_item_destroy</a>(<span class="keywordtype">void</span> * pItem)
00060 {
00061   <a class="code" href="cli_8c.html#a4">cli_cmd_param_destroy</a>((<a class="code" href="structSCliCmdParam.html">SCliCmdParam</a> **) pItem);
00062 }
00063 
00064 <span class="comment">// ----- cli_params_create ------------------------------------------</span>
<a name="l00068"></a><a class="code" href="cli_8c.html#a7">00068</a> <span class="comment"></span><a class="code" href="structSPtrArray.html">SCliParams</a> * <a class="code" href="cli_8c.html#a7">cli_params_create</a>()
00069 {
00070   <span class="keywordflow">return</span> (<a class="code" href="structSPtrArray.html">SCliParams</a> *) <a class="code" href="array_8h.html#a12">ptr_array_create</a>(0,
00071                                          <a class="code" href="cli_8c.html#a5">cli_params_item_compare</a>,
00072                                          <a class="code" href="cli_8c.html#a6">cli_params_item_destroy</a>);
00073 }
00074 
00075 <span class="comment">// ----- cli_params_destroy -----------------------------------------</span>
<a name="l00079"></a><a class="code" href="cli_8c.html#a8">00079</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="cli_8c.html#a8">cli_params_destroy</a>(<a class="code" href="structSPtrArray.html">SCliParams</a> ** ppParams)
00080 {
00081   <a class="code" href="array_8h.html#a13">ptr_array_destroy</a>((<a class="code" href="structSPtrArray.html">SPtrArray</a> **) ppParams);
00082 }
00083 
00084 <span class="comment">// ----- cli_params_add ---------------------------------------------</span>
<a name="l00088"></a><a class="code" href="cli_8c.html#a9">00088</a> <span class="comment"></span><span class="keywordtype">int</span> <a class="code" href="cli_8c.html#a9">cli_params_add</a>(<a class="code" href="structSPtrArray.html">SCliParams</a> * pParams, <span class="keywordtype">char</span> * pcName,
00089                    FCliCheckParam fCheckParam)
00090 {
00091   <a class="code" href="structSCliCmdParam.html">SCliCmdParam</a> * pParam= <a class="code" href="cli_8c.html#a3">cli_cmd_param_create</a>(pcName, fCheckParam);
00092   <span class="keywordflow">return</span> <a class="code" href="array_8h.html#a17">ptr_array_add</a>((<a class="code" href="structSPtrArray.html">SPtrArray</a> *) pParams, &amp;pParam);
00093 }
00094 
00095 <span class="comment">// ----- cli_cmd_create ---------------------------------------------</span>
<a name="l00099"></a><a class="code" href="cli_8c.html#a10">00099</a> <span class="comment"></span><a class="code" href="structSCliCmd.html">SCliCmd</a> * <a class="code" href="cli_8c.html#a10">cli_cmd_create</a>(<span class="keywordtype">char</span> * pcName,
00100                          FCliCommand fCommand,
00101                          <a class="code" href="structSPtrArray.html">SCliCmds</a> * pSubCmds,
00102                          <a class="code" href="structSPtrArray.html">SCliParams</a> * pParams)
00103 {
00104   <a class="code" href="structSCliCmd.html">SCliCmd</a> * pCmd= (<a class="code" href="structSCliCmd.html">SCliCmd</a> *) <a class="code" href="memory_8h.html#a0">MALLOC</a>(<span class="keyword">sizeof</span>(<a class="code" href="structSCliCmd.html">SCliCmd</a>));
00105 
00106   pCmd-&gt;<a class="code" href="structSCliCmd.html#o0">pcName</a>= (<span class="keywordtype">char</span> *) <a class="code" href="memory_8h.html#a0">MALLOC</a>(<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>)*(strlen(pcName)+1));
00107   strcpy(pCmd-&gt;<a class="code" href="structSCliCmd.html#o0">pcName</a>, pcName);
00108   pCmd-&gt;<a class="code" href="structSCliCmd.html#o2">pParams</a>= pParams;
00109   pCmd-&gt;<a class="code" href="structSCliCmd.html#o1">pSubCmds</a>= pSubCmds;
00110   pCmd-&gt;<a class="code" href="structSCliCmd.html#o3">fCtxCreate</a>= NULL;
00111   pCmd-&gt;<a class="code" href="structSCliCmd.html#o4">fCtxDestroy</a>= NULL;
00112   pCmd-&gt;<a class="code" href="structSCliCmd.html#o5">fCommand</a>= fCommand;
00113   <span class="keywordflow">return</span> pCmd;
00114 }
00115 
00116 <span class="comment">// ----- cli_cmd_create_ctx -----------------------------------------</span>
<a name="l00120"></a><a class="code" href="cli_8c.html#a11">00120</a> <span class="comment"></span><a class="code" href="structSCliCmd.html">SCliCmd</a> * <a class="code" href="cli_8c.html#a11">cli_cmd_create_ctx</a>(<span class="keywordtype">char</span> * pcName,
00121                              FCliContextCreate fCtxCreate,
00122                              FCliContextDestroy fCtxDestroy,
00123                              <a class="code" href="structSPtrArray.html">SCliCmds</a> * pSubCmds,
00124                              <a class="code" href="structSPtrArray.html">SCliParams</a> * pParams)
00125 {
00126   <a class="code" href="structSCliCmd.html">SCliCmd</a> * pCmd= (<a class="code" href="structSCliCmd.html">SCliCmd</a> *) <a class="code" href="memory_8h.html#a0">MALLOC</a>(<span class="keyword">sizeof</span>(<a class="code" href="structSCliCmd.html">SCliCmd</a>));
00127 
00128   pCmd-&gt;<a class="code" href="structSCliCmd.html#o0">pcName</a>= (<span class="keywordtype">char</span> *) <a class="code" href="memory_8h.html#a0">MALLOC</a>(<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>)*(strlen(pcName)+1));
00129   strcpy(pCmd-&gt;<a class="code" href="structSCliCmd.html#o0">pcName</a>, pcName);
00130   pCmd-&gt;<a class="code" href="structSCliCmd.html#o2">pParams</a>= pParams;
00131   pCmd-&gt;<a class="code" href="structSCliCmd.html#o1">pSubCmds</a>= pSubCmds;
00132   pCmd-&gt;<a class="code" href="structSCliCmd.html#o3">fCtxCreate</a>= fCtxCreate;
00133   pCmd-&gt;<a class="code" href="structSCliCmd.html#o4">fCtxDestroy</a>= fCtxDestroy;
00134   pCmd-&gt;<a class="code" href="structSCliCmd.html#o5">fCommand</a>= NULL;
00135   <span class="keywordflow">return</span> pCmd;
00136 }
00137 
00138 <span class="comment">// ----- cli_cmd_destroy --------------------------------------------</span>
<a name="l00142"></a><a class="code" href="cli_8c.html#a12">00142</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="cli_8c.html#a12">cli_cmd_destroy</a>(<a class="code" href="structSCliCmd.html">SCliCmd</a> ** ppCmd)
00143 {
00144   <span class="keywordflow">if</span> (*ppCmd != NULL) {
00145     <a class="code" href="memory_8h.html#a2">FREE</a>((*ppCmd)-&gt;pcName);
00146     <a class="code" href="array_8h.html#a13">ptr_array_destroy</a>(&amp;(*ppCmd)-&gt;pSubCmds);
00147     <a class="code" href="array_8h.html#a13">ptr_array_destroy</a>(&amp;(*ppCmd)-&gt;pParams);
00148     <a class="code" href="memory_8h.html#a2">FREE</a>(*ppCmd);
00149     *ppCmd= NULL;
00150   }
00151 }
00152 
00153 <span class="comment">// ----- cli_cmd_dump -----------------------------------------------</span>
<a name="l00157"></a><a class="code" href="cli_8c.html#a13">00157</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="cli_8c.html#a13">cli_cmd_dump</a>(FILE * pStream, <span class="keywordtype">char</span> * pcPrefix, <a class="code" href="structSCliCmd.html">SCliCmd</a> * pCmd)
00158 {
00159   <span class="keywordtype">int</span> iIndex;
00160   <a class="code" href="structSCliCmd.html">SCliCmd</a> * pSubCmd;
00161   <a class="code" href="structSCliCmdParam.html">SCliCmdParam</a> * pParam;
00162   <span class="keywordtype">char</span> * pcNewPrefix;
00163 
00164   fprintf(pStream, <span class="stringliteral">"%s%s"</span>, pcPrefix, pCmd-&gt;<a class="code" href="structSCliCmd.html#o0">pcName</a>);
00165   <span class="keywordflow">if</span> (pCmd-&gt;<a class="code" href="structSCliCmd.html#o2">pParams</a> != NULL)
00166     <span class="keywordflow">for</span> (iIndex= 0; iIndex &lt; <a class="code" href="array_8h.html#a14">ptr_array_length</a>(pCmd-&gt;<a class="code" href="structSCliCmd.html#o2">pParams</a>); iIndex++) {
00167       pParam= (<a class="code" href="structSCliCmdParam.html">SCliCmdParam</a> *) pCmd-&gt;<a class="code" href="structSCliCmd.html#o2">pParams</a>-&gt;<a class="code" href="structSPtrArray.html#o0">data</a>[iIndex];
00168       fprintf(pStream, <span class="stringliteral">" %s"</span>, pParam-&gt;<a class="code" href="structSCliCmdParam.html#o0">pcName</a>);
00169     }
00170   fprintf(pStream, <span class="stringliteral">"\n"</span>);
00171   <span class="keywordflow">if</span> (pCmd-&gt;<a class="code" href="structSCliCmd.html#o1">pSubCmds</a> != NULL) {
00172     pcNewPrefix= (<span class="keywordtype">char</span> *) <a class="code" href="memory_8h.html#a0">MALLOC</a>(<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>)*(strlen(pcPrefix)+3));
00173     strcpy(pcNewPrefix, pcPrefix);
00174     strcat(pcNewPrefix, <span class="stringliteral">"  "</span>);
00175     <span class="keywordflow">for</span> (iIndex= 0; iIndex &lt; <a class="code" href="array_8h.html#a14">ptr_array_length</a>(pCmd-&gt;<a class="code" href="structSCliCmd.html#o1">pSubCmds</a>); iIndex++) {
00176       pSubCmd= (<a class="code" href="structSCliCmd.html">SCliCmd</a> *) pCmd-&gt;<a class="code" href="structSCliCmd.html#o1">pSubCmds</a>-&gt;<a class="code" href="structSPtrArray.html#o0">data</a>[iIndex];
00177       <a class="code" href="cli_8c.html#a13">cli_cmd_dump</a>(pStream, pcNewPrefix, pSubCmd);
00178     }
00179     <a class="code" href="memory_8h.html#a2">FREE</a>(pcNewPrefix);
00180   }
00181 }
00182 
00183 <span class="comment">// ----- cli_cmds_item_compare --------------------------------------</span>
<a name="l00184"></a><a class="code" href="cli_8c.html#a14">00184</a> <span class="keywordtype">int</span> <a class="code" href="cli_8c.html#a14">cli_cmds_item_compare</a>(<span class="keywordtype">void</span> * pItem1, <span class="keywordtype">void</span> * pItem2,
00185                           uint32_t EltSize)
00186 {
00187   <a class="code" href="structSCliCmd.html">SCliCmd</a> * pCmd1= *((<a class="code" href="structSCliCmd.html">SCliCmd</a> **) pItem1);
00188   <a class="code" href="structSCliCmd.html">SCliCmd</a> * pCmd2= *((<a class="code" href="structSCliCmd.html">SCliCmd</a> **) pItem2);
00189 
00190   <span class="keywordflow">return</span> strcmp(pCmd1-&gt;<a class="code" href="structSCliCmd.html#o0">pcName</a>, pCmd2-&gt;<a class="code" href="structSCliCmd.html#o0">pcName</a>);
00191 }
00192 
00193 <span class="comment">// ----- cli_cmds_item_destroy --------------------------------------</span>
<a name="l00194"></a><a class="code" href="cli_8c.html#a15">00194</a> <span class="keywordtype">void</span> <a class="code" href="cli_8c.html#a15">cli_cmds_item_destroy</a>(<span class="keywordtype">void</span> * pItem)
00195 {
00196   <a class="code" href="cli_8c.html#a12">cli_cmd_destroy</a>((<a class="code" href="structSCliCmd.html">SCliCmd</a> **) pItem);
00197 }
00198 
00199 <span class="comment">// ----- cli_cmds_create --------------------------------------------</span>
<a name="l00203"></a><a class="code" href="cli_8c.html#a16">00203</a> <span class="comment"></span><a class="code" href="structSPtrArray.html">SCliCmds</a> * <a class="code" href="cli_8c.html#a16">cli_cmds_create</a>()
00204 {
00205   <span class="keywordflow">return</span> (<a class="code" href="structSPtrArray.html">SCliCmds</a> *) <a class="code" href="array_8h.html#a12">ptr_array_create</a>(<a class="code" href="array_8h.html#a0">ARRAY_OPTION_SORTED</a>,
00206                                        <a class="code" href="cli_8c.html#a14">cli_cmds_item_compare</a>,
00207                                        <a class="code" href="cli_8c.html#a15">cli_cmds_item_destroy</a>);
00208 }
00209 
00210 <span class="comment">// ----- cli_cmds_destroy -------------------------------------------</span>
<a name="l00214"></a><a class="code" href="cli_8c.html#a17">00214</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="cli_8c.html#a17">cli_cmds_destroy</a>(<a class="code" href="structSPtrArray.html">SCliCmds</a> ** ppCmds)
00215 {
00216   <a class="code" href="array_8h.html#a13">ptr_array_destroy</a>((<a class="code" href="structSPtrArray.html">SPtrArray</a> **) ppCmds);
00217 }
00218 
00219 <span class="comment">// ----- cli_cmds_add -----------------------------------------------</span>
<a name="l00223"></a><a class="code" href="cli_8c.html#a18">00223</a> <span class="comment"></span><span class="keywordtype">int</span> <a class="code" href="cli_8c.html#a18">cli_cmds_add</a>(<a class="code" href="structSPtrArray.html">SCliCmds</a> * pCmds, <a class="code" href="structSCliCmd.html">SCliCmd</a> * pCmd)
00224 {
00225   <span class="keywordflow">return</span> <a class="code" href="array_8h.html#a17">ptr_array_add</a>((<a class="code" href="structSPtrArray.html">SPtrArray</a> *) pCmds, &amp;pCmd);
00226 }
00227 
00228 <span class="comment">// ----- cli_cmd_find_submd -----------------------------------------</span>
<a name="l00232"></a><a class="code" href="cli_8c.html#a19">00232</a> <span class="comment"></span><a class="code" href="structSCliCmd.html">SCliCmd</a> * <a class="code" href="cli_8c.html#a19">cli_cmd_find_subcmd</a>(<a class="code" href="structSCliCmd.html">SCliCmd</a> * pCmd, <span class="keywordtype">char</span> * pcName)
00233 {
00234   <span class="keywordtype">char</span> ** x= &amp;pcName;
00235   <span class="keywordtype">int</span> iIndex;
00236 
00237   <span class="keywordflow">if</span> (pCmd-&gt;<a class="code" href="structSCliCmd.html#o1">pSubCmds</a> != NULL)
00238     <span class="keywordflow">if</span> (!<a class="code" href="array_8h.html#a16">ptr_array_sorted_find_index</a>(pCmd-&gt;<a class="code" href="structSCliCmd.html#o1">pSubCmds</a>, &amp;x, &amp;iIndex))
00239       <span class="keywordflow">return</span> pCmd-&gt;<a class="code" href="structSCliCmd.html#o1">pSubCmds</a>-&gt;<a class="code" href="structSPtrArray.html#o0">data</a>[iIndex];
00240   <span class="keywordflow">return</span> NULL;
00241 }
00242 
00243 <span class="comment">// ----- cli_cmd_get_num_subcmds ------------------------------------</span>
<a name="l00247"></a><a class="code" href="cli_8c.html#a20">00247</a> <span class="comment"></span><span class="keywordtype">int</span> <a class="code" href="cli_8c.html#a20">cli_cmd_get_num_subcmds</a>(<a class="code" href="structSCliCmd.html">SCliCmd</a> * pCmd)
00248 {
00249   <span class="keywordflow">if</span> (pCmd-&gt;<a class="code" href="structSCliCmd.html#o1">pSubCmds</a> != NULL)
00250     <span class="keywordflow">return</span> <a class="code" href="array_8h.html#a14">ptr_array_length</a>(pCmd-&gt;<a class="code" href="structSCliCmd.html#o1">pSubCmds</a>);
00251   <span class="keywordflow">return</span> 0;
00252 }
00253 
00254 <span class="comment">// ----- cli_cmd_get_subcmd_at --------------------------------------</span>
<a name="l00258"></a><a class="code" href="cli_8c.html#a21">00258</a> <span class="comment"></span><a class="code" href="structSCliCmd.html">SCliCmd</a> * <a class="code" href="cli_8c.html#a21">cli_cmd_get_subcmd_at</a>(<a class="code" href="structSCliCmd.html">SCliCmd</a> * pCmd, <span class="keywordtype">int</span> iIndex)
00259 {
00260   <span class="keywordflow">return</span> (<a class="code" href="structSCliCmd.html">SCliCmd</a> *) pCmd-&gt;<a class="code" href="structSCliCmd.html#o1">pSubCmds</a>-&gt;<a class="code" href="structSPtrArray.html#o0">data</a>[iIndex];
00261 }
00262 
00263 <span class="comment">// ----- cli_cmd_add_subcmd -----------------------------------------</span>
<a name="l00267"></a><a class="code" href="cli_8c.html#a22">00267</a> <span class="comment"></span><span class="keywordtype">int</span> <a class="code" href="cli_8c.html#a22">cli_cmd_add_subcmd</a>(<a class="code" href="structSCliCmd.html">SCliCmd</a> * pCmd, <a class="code" href="structSCliCmd.html">SCliCmd</a> * pSubCmd)
00268 {
00269   <span class="keywordflow">if</span> (pCmd-&gt;<a class="code" href="structSCliCmd.html#o1">pSubCmds</a> == NULL)
00270     pCmd-&gt;<a class="code" href="structSCliCmd.html#o1">pSubCmds</a>= <a class="code" href="cli_8c.html#a16">cli_cmds_create</a>();
00271   <span class="keywordflow">return</span> <a class="code" href="cli_8c.html#a18">cli_cmds_add</a>(pCmd-&gt;<a class="code" href="structSCliCmd.html#o1">pSubCmds</a>, pSubCmd);
00272 }
00273 
00274 <span class="comment">// ----- cli_cmd_add_param ------------------------------------------</span>
<a name="l00278"></a><a class="code" href="cli_8c.html#a23">00278</a> <span class="comment"></span><span class="keywordtype">int</span> <a class="code" href="cli_8c.html#a23">cli_cmd_add_param</a>(<a class="code" href="structSCliCmd.html">SCliCmd</a> * pCmd, <span class="keywordtype">char</span> * pcName,
00279                       FCliCheckParam fCheckParam)
00280 {
00281   <span class="keywordflow">if</span> (pCmd-&gt;<a class="code" href="structSCliCmd.html#o2">pParams</a> == NULL)
00282     pCmd-&gt;<a class="code" href="structSCliCmd.html#o2">pParams</a>= <a class="code" href="cli_8c.html#a7">cli_params_create</a>();
00283   <span class="keywordflow">return</span> <a class="code" href="cli_8c.html#a9">cli_params_add</a>(pCmd-&gt;<a class="code" href="structSCliCmd.html#o2">pParams</a>, pcName, fCheckParam);
00284 }
00285 
00286 <span class="comment">// ----- cli_cmd_get_num_params -------------------------------------</span>
<a name="l00290"></a><a class="code" href="cli_8c.html#a24">00290</a> <span class="comment"></span><span class="keywordtype">int</span> <a class="code" href="cli_8c.html#a24">cli_cmd_get_num_params</a>(<a class="code" href="structSCliCmd.html">SCliCmd</a> * pCmd)
00291 {
00292   <span class="keywordflow">if</span> (pCmd-&gt;<a class="code" href="structSCliCmd.html#o2">pParams</a> == NULL)
00293     <span class="keywordflow">return</span> 0;
00294   <span class="keywordflow">return</span> <a class="code" href="array_8h.html#a14">ptr_array_length</a>(pCmd-&gt;<a class="code" href="structSCliCmd.html#o2">pParams</a>);
00295 }
00296 
00297 <span class="comment">// ----- cli_cmd_get_param_at ---------------------------------------</span>
<a name="l00301"></a><a class="code" href="cli_8c.html#a25">00301</a> <span class="comment"></span><a class="code" href="structSCliCmdParam.html">SCliCmdParam</a> * <a class="code" href="cli_8c.html#a25">cli_cmd_get_param_at</a>(<a class="code" href="structSCliCmd.html">SCliCmd</a> * pCmd, uint32_t uIndex)
00302 {
00303   <span class="keywordflow">return</span> (<a class="code" href="structSCliCmdParam.html">SCliCmdParam</a> *) pCmd-&gt;<a class="code" href="structSCliCmd.html#o2">pParams</a>-&gt;<a class="code" href="structSPtrArray.html#o0">data</a>[uIndex];
00304 }
00305 
00306 <span class="comment">// ----- cli_create -------------------------------------------------</span>
<a name="l00310"></a><a class="code" href="cli_8c.html#a26">00310</a> <span class="comment"></span><a class="code" href="structSCli.html">SCli</a> * <a class="code" href="cli_8c.html#a26">cli_create</a>()
00311 {
00312   <a class="code" href="structSCli.html">SCli</a> * pCli= (<a class="code" href="structSCli.html">SCli</a> *) <a class="code" href="memory_8h.html#a0">MALLOC</a>(<span class="keyword">sizeof</span>(<a class="code" href="structSCli.html">SCli</a>));
00313 
00314   pCli-&gt;<a class="code" href="structSCli.html#o0">pTokenizer</a>= <a class="code" href="tokenizer_8c.html#a18">tokenizer_create</a>(<a class="code" href="cli_8c.html#a0">CLI_DELIMITERS</a>,
00315                                      <a class="code" href="cli_8c.html#a1">CLI_OPENING_QUOTES</a>,
00316                                      <a class="code" href="cli_8c.html#a2">CLI_CLOSING_QUOTES</a>);
00317   pCli-&gt;<a class="code" href="structSCli.html#o1">pBaseCommand</a>= NULL;
00318   pCli-&gt;<a class="code" href="structSCli.html#o4">pExecCmd</a>= NULL;
00319   pCli-&gt;<a class="code" href="structSCli.html#o5">pExecParam</a>= NULL;
00320   pCli-&gt;<a class="code" href="structSCli.html#o2">pExecContext</a>= <a class="code" href="cli__ctx_8c.html#a3">cli_context_create</a>();
00321   <span class="keywordflow">return</span> pCli;
00322 }
00323 
00324 <span class="comment">// ----- cli_destroy ------------------------------------------------</span>
<a name="l00328"></a><a class="code" href="cli_8c.html#a27">00328</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="cli_8c.html#a27">cli_destroy</a>(<a class="code" href="structSCli.html">SCli</a> ** ppCli)
00329 {
00330   <span class="keywordflow">if</span> (*ppCli != NULL) {
00331     <a class="code" href="tokenizer_8c.html#a19">tokenizer_destroy</a>(&amp;(*ppCli)-&gt;pTokenizer);
00332     <a class="code" href="cli__ctx_8c.html#a4">cli_context_destroy</a>(&amp;(*ppCli)-&gt;pExecContext);
00333     <a class="code" href="cli_8c.html#a12">cli_cmd_destroy</a>(&amp;(*ppCli)-&gt;pBaseCommand);
00334     <a class="code" href="memory_8h.html#a2">FREE</a>(*ppCli);
00335     *ppCli= NULL;
00336   }
00337 }
00338 
00339 <span class="comment">// ----- cli_execute_cmd --------------------------------------------</span>
<a name="l00343"></a><a class="code" href="cli_8c.html#a28">00343</a> <span class="comment"></span><span class="keywordtype">int</span> <a class="code" href="cli_8c.html#a28">cli_execute_cmd</a>(<a class="code" href="structSCli.html">SCli</a> * pCli, <a class="code" href="structSCliCmd.html">SCliCmd</a> * pCmd)
00344 {
00345   <span class="keywordtype">int</span> iParamIndex;
00346   <span class="keywordtype">int</span> iResult;
00347   <span class="keywordtype">char</span> * pcParamValue;
00348   <a class="code" href="structSPtrArray.html">STokens</a> * pTokens= <a class="code" href="tokenizer_8c.html#a20">tokenizer_get_tokens</a>(pCli-&gt;<a class="code" href="structSCli.html#o0">pTokenizer</a>);
00349   <span class="keywordtype">void</span> * pContextItem;
00350 
00351   <span class="comment">// Match all the command's parameters</span>
00352   <span class="keywordflow">for</span> (iParamIndex= 0;
00353        iParamIndex &lt; <a class="code" href="cli_8c.html#a24">cli_cmd_get_num_params</a>(pCli-&gt;<a class="code" href="structSCli.html#o4">pExecCmd</a>);
00354        iParamIndex++) {
00355     pCli-&gt;<a class="code" href="structSCli.html#o5">pExecParam</a>= <a class="code" href="cli_8c.html#a25">cli_cmd_get_param_at</a>(pCli-&gt;<a class="code" href="structSCli.html#o4">pExecCmd</a>, iParamIndex);
00356     <span class="comment">// Still enough parameters in command-line ?</span>
00357     <span class="keywordflow">if</span> (pCli-&gt;<a class="code" href="structSCli.html#o3">iExecTokenIndex</a> &gt;= <a class="code" href="tokenizer_8c.html#a13">tokens_get_num</a>(pTokens))
00358       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a3">CLI_ERROR_MISSING_PARAMETER</a>;
00359     pcParamValue= <a class="code" href="tokenizer_8c.html#a14">tokens_get_string_at</a>(pTokens, pCli-&gt;<a class="code" href="structSCli.html#o3">iExecTokenIndex</a>);
00360     <span class="comment">// Check the parameter's value (if required)</span>
00361     <span class="keywordflow">if</span> (pCli-&gt;<a class="code" href="structSCli.html#o5">pExecParam</a>-&gt;<a class="code" href="structSCliCmdParam.html#o1">fCheckParam</a> != NULL) {
00362       iResult= pCli-&gt;<a class="code" href="structSCli.html#o5">pExecParam</a>-&gt;<a class="code" href="structSCliCmdParam.html#o1">fCheckParam</a>(pcParamValue);
00363       <span class="keywordflow">if</span> (iResult)
00364         <span class="keywordflow">return</span> iResult; <span class="comment">// parameter error !!!</span>
00365     }
00366     <a class="code" href="cli__ctx_8c.html#a13">cli_context_add_token_copy</a>(pCli-&gt;<a class="code" href="structSCli.html#o2">pExecContext</a>, pcParamValue);
00367     pCli-&gt;<a class="code" href="structSCli.html#o3">iExecTokenIndex</a>++;
00368   }
00369 
00370   <span class="comment">// Produce context ?</span>
00371   <span class="keywordflow">if</span> (pCli-&gt;<a class="code" href="structSCli.html#o4">pExecCmd</a>-&gt;<a class="code" href="structSCliCmd.html#o3">fCtxCreate</a> != NULL) {
00372     pContextItem= NULL;
00373     iResult= pCli-&gt;<a class="code" href="structSCli.html#o4">pExecCmd</a>-&gt;<a class="code" href="structSCliCmd.html#o3">fCtxCreate</a>(pCli-&gt;<a class="code" href="structSCli.html#o2">pExecContext</a>, &amp;pContextItem);
00374     <span class="keywordflow">if</span> (iResult)
00375       <span class="keywordflow">return</span> iResult;
00376     <a class="code" href="cli__ctx_8c.html#a7">cli_context_push</a>(pCli-&gt;<a class="code" href="structSCli.html#o2">pExecContext</a>, pContextItem, pCli-&gt;<a class="code" href="structSCli.html#o4">pExecCmd</a>);
00377   }
00378 
00379   <span class="comment">// Execute command ?</span>
00380   <span class="keywordflow">if</span> (pCli-&gt;<a class="code" href="structSCli.html#o3">iExecTokenIndex</a> == <a class="code" href="tokenizer_8c.html#a13">tokens_get_num</a>(pTokens)) {
00381     <span class="keywordflow">if</span> (pCli-&gt;<a class="code" href="structSCli.html#o4">pExecCmd</a>-&gt;<a class="code" href="structSCliCmd.html#o5">fCommand</a> != NULL) {
00382       iResult= pCli-&gt;<a class="code" href="structSCli.html#o4">pExecCmd</a>-&gt;<a class="code" href="structSCliCmd.html#o5">fCommand</a>(pCli-&gt;<a class="code" href="structSCli.html#o2">pExecContext</a>,
00383                                         pCli-&gt;<a class="code" href="structSCli.html#o2">pExecContext</a>-&gt;<a class="code" href="structSCliContext.html#o2">pTokens</a>);
00384       <span class="comment">// Return to saved context level</span>
00385       <a class="code" href="cli__ctx_8c.html#a17">cli_context_restore_depth</a>(pCli-&gt;<a class="code" href="structSCli.html#o2">pExecContext</a>);
00386     } <span class="keywordflow">else</span>
00387       <span class="keywordflow">if</span> (pCli-&gt;<a class="code" href="structSCli.html#o4">pExecCmd</a>-&gt;<a class="code" href="structSCliCmd.html#o3">fCtxCreate</a> == NULL)
00388         <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a4">CLI_ERROR_NOT_A_COMMAND</a>;
00389   }
00390 
00391   <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a0">CLI_SUCCESS</a>;
00392 }
00393 
00394 <span class="comment">// ----- cli_execute ------------------------------------------------</span>
<a name="l00398"></a><a class="code" href="cli_8c.html#a29">00398</a> <span class="comment"></span><span class="keywordtype">int</span> <a class="code" href="cli_8c.html#a29">cli_execute</a>(<a class="code" href="structSCli.html">SCli</a> * pCli, <span class="keywordtype">char</span> * pcCmd)
00399 {
00400   <span class="keywordtype">int</span> iResult= <a class="code" href="cli_8h.html#a0">CLI_SUCCESS</a>;
00401   <a class="code" href="structSPtrArray.html">STokens</a> * pTokens;
00402   <span class="keywordtype">char</span> * pcToken;
00403   <a class="code" href="structSCliCmd.html">SCliCmd</a> * pNewCmd;
00404   <a class="code" href="structSCliCtxItem.html">SCliCtxItem</a> * pCtxItem;
00405 
00406   <span class="comment">// Split command line into tokens...</span>
00407   <span class="keywordflow">if</span> (<a class="code" href="tokenizer_8c.html#a21">tokenizer_run</a>(pCli-&gt;<a class="code" href="structSCli.html#o0">pTokenizer</a>, pcCmd))
00408     <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a1">CLI_ERROR_UNEXPECTED</a>;
00409   pTokens= <a class="code" href="tokenizer_8c.html#a20">tokenizer_get_tokens</a>(pCli-&gt;<a class="code" href="structSCli.html#o0">pTokenizer</a>);
00410 
00411   <span class="comment">// Empty line ?</span>
00412   <span class="keywordflow">if</span> (<a class="code" href="tokenizer_8c.html#a13">tokens_get_num</a>(pTokens) == 0) {
00413     <a class="code" href="cli__ctx_8c.html#a14">cli_context_clear</a>(pCli-&gt;<a class="code" href="structSCli.html#o2">pExecContext</a>);
00414     <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a0">CLI_SUCCESS</a>;
00415   }
00416   <span class="comment">// Single "exit" token ?</span>
00417   <span class="keywordflow">if</span> ((<a class="code" href="tokenizer_8c.html#a13">tokens_get_num</a>(pTokens) == 1) &amp;&amp;
00418       (!strcmp(<span class="stringliteral">"exit"</span>, <a class="code" href="tokenizer_8c.html#a14">tokens_get_string_at</a>(pTokens, 0)))) {
00419     <a class="code" href="cli__ctx_8c.html#a15">cli_context_backtrack</a>(pCli-&gt;<a class="code" href="structSCli.html#o2">pExecContext</a>);
00420     <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a0">CLI_SUCCESS</a>;
00421   }
00422   <span class="comment">// Context available ?</span>
00423   <span class="keywordflow">if</span> (!<a class="code" href="cli__ctx_8c.html#a6">cli_context_is_empty</a>(pCli-&gt;<a class="code" href="structSCli.html#o2">pExecContext</a>)) {
00424     pCtxItem= <a class="code" href="cli__ctx_8c.html#a9">cli_context_top</a>(pCli-&gt;<a class="code" href="structSCli.html#o2">pExecContext</a>);
00425     assert(pCtxItem != NULL);
00426     pCli-&gt;<a class="code" href="structSCli.html#o4">pExecCmd</a>= pCtxItem-&gt;<a class="code" href="structSCliCtxItem.html#o1">pCmd</a>;
00427     <span class="comment">// Strip params ?</span>
00428     <span class="keywordflow">while</span> (<a class="code" href="tokenizer_8c.html#a13">tokens_get_num</a>(pCli-&gt;<a class="code" href="structSCli.html#o2">pExecContext</a>-&gt;<a class="code" href="structSCliContext.html#o2">pTokens</a>) &gt; pCtxItem-&gt;<a class="code" href="structSCliCtxItem.html#o2">uNumParams</a>)
00429       <a class="code" href="array_8h.html#a19">ptr_array_remove_at</a>((<a class="code" href="structSPtrArray.html">SPtrArray</a> *) pCli-&gt;<a class="code" href="structSCli.html#o2">pExecContext</a>-&gt;<a class="code" href="structSCliContext.html#o2">pTokens</a>,
00430                           <a class="code" href="tokenizer_8c.html#a13">tokens_get_num</a>(pCli-&gt;<a class="code" href="structSCli.html#o2">pExecContext</a>-&gt;<a class="code" href="structSCliContext.html#o2">pTokens</a>)-1);
00431   } <span class="keywordflow">else</span> {
00432     pCli-&gt;<a class="code" href="structSCli.html#o4">pExecCmd</a>= pCli-&gt;<a class="code" href="structSCli.html#o1">pBaseCommand</a>;
00433     <a class="code" href="tokenizer_8c.html#a10">tokens_destroy</a>(&amp;pCli-&gt;<a class="code" href="structSCli.html#o2">pExecContext</a>-&gt;<a class="code" href="structSCliContext.html#o2">pTokens</a>);
00434     pCli-&gt;<a class="code" href="structSCli.html#o2">pExecContext</a>-&gt;<a class="code" href="structSCliContext.html#o2">pTokens</a>= <a class="code" href="tokenizer_8c.html#a9">tokens_create</a>();
00435   }
00436   pCli-&gt;<a class="code" href="structSCli.html#o3">iExecTokenIndex</a>= 0;
00437   pCli-&gt;<a class="code" href="structSCli.html#o5">pExecParam</a>= NULL;
00438   <a class="code" href="cli__ctx_8c.html#a16">cli_context_save_depth</a>(pCli-&gt;<a class="code" href="structSCli.html#o2">pExecContext</a>);
00439 
00440   <span class="comment">// Match all tokens...</span>
00441   <span class="keywordflow">while</span> (pCli-&gt;<a class="code" href="structSCli.html#o3">iExecTokenIndex</a> &lt; <a class="code" href="tokenizer_8c.html#a23">tokenizer_get_num_tokens</a>(pCli-&gt;<a class="code" href="structSCli.html#o0">pTokenizer</a>)) {
00442     <span class="keywordflow">if</span> (pCli-&gt;<a class="code" href="structSCli.html#o4">pExecCmd</a> != NULL) {
00443       pcToken= <a class="code" href="tokenizer_8c.html#a14">tokens_get_string_at</a>(pTokens, pCli-&gt;<a class="code" href="structSCli.html#o3">iExecTokenIndex</a>);
00444       pNewCmd= <a class="code" href="cli_8c.html#a19">cli_cmd_find_subcmd</a>(pCli-&gt;<a class="code" href="structSCli.html#o4">pExecCmd</a>, pcToken);
00445       <span class="keywordflow">if</span> (pNewCmd == NULL) {
00446         iResult= <a class="code" href="cli_8h.html#a2">CLI_ERROR_UNKNOWN_COMMAND</a>;
00447         <span class="keywordflow">break</span>;
00448       }
00449       pCli-&gt;<a class="code" href="structSCli.html#o4">pExecCmd</a>= pNewCmd;
00450       pCli-&gt;<a class="code" href="structSCli.html#o3">iExecTokenIndex</a>++;
00451       iResult= <a class="code" href="cli_8c.html#a28">cli_execute_cmd</a>(pCli, pCli-&gt;<a class="code" href="structSCli.html#o4">pExecCmd</a>);
00452       <span class="keywordflow">if</span> (iResult)
00453         <span class="keywordflow">break</span>;
00454     } <span class="keywordflow">else</span> {
00455       iResult= <a class="code" href="cli_8h.html#a2">CLI_ERROR_UNKNOWN_COMMAND</a>;
00456       <span class="keywordflow">break</span>;
00457     }
00458   }
00459   <span class="keywordflow">return</span> iResult;
00460 }
00461 
00462 <span class="comment">// ----- cli_register_cmd -------------------------------------------</span>
<a name="l00466"></a><a class="code" href="cli_8c.html#a30">00466</a> <span class="comment"></span><span class="keywordtype">int</span> <a class="code" href="cli_8c.html#a30">cli_register_cmd</a>(<a class="code" href="structSCli.html">SCli</a> * pCli, <a class="code" href="structSCliCmd.html">SCliCmd</a> * pCmd)
00467 {
00468   <span class="keywordflow">if</span> (pCli-&gt;<a class="code" href="structSCli.html#o1">pBaseCommand</a> == NULL)
00469     pCli-&gt;<a class="code" href="structSCli.html#o1">pBaseCommand</a>= <a class="code" href="cli_8c.html#a10">cli_cmd_create</a>(<span class="stringliteral">""</span>, NULL, NULL, NULL);
00470   <span class="keywordflow">return</span> <a class="code" href="cli_8c.html#a22">cli_cmd_add_subcmd</a>(pCli-&gt;<a class="code" href="structSCli.html#o1">pBaseCommand</a>, pCmd);
00471 }
00472 
00473 <span class="comment">// ----- cli_perror -------------------------------------------------</span>
<a name="l00477"></a><a class="code" href="cli_8c.html#a31">00477</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="cli_8c.html#a31">cli_perror</a>(FILE * pStream, <span class="keywordtype">int</span> iErrorCode)
00478 {
00479   <span class="keywordflow">switch</span> (iErrorCode) {
00480   <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a0">CLI_SUCCESS</a>:
00481     fprintf(pStream, <span class="stringliteral">"success\n"</span>); <span class="keywordflow">break</span>;
00482   <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1">CLI_ERROR_UNEXPECTED</a>:
00483         fprintf(pStream, <span class="stringliteral">"unexpected error\n"</span>); <span class="keywordflow">break</span>;
00484   <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a2">CLI_ERROR_UNKNOWN_COMMAND</a>:
00485     fprintf(pStream, <span class="stringliteral">"unknown command\n"</span>); <span class="keywordflow">break</span>;
00486   <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a3">CLI_ERROR_MISSING_PARAMETER</a>:
00487     fprintf(pStream, <span class="stringliteral">"missing parameter\n"</span>); <span class="keywordflow">break</span>;
00488   <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a4">CLI_ERROR_NOT_A_COMMAND</a>:
00489     fprintf(pStream, <span class="stringliteral">"not a command\n"</span>); <span class="keywordflow">break</span>;
00490   <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a5">CLI_ERROR_COMMAND_FAILED</a>:
00491     fprintf(pStream, <span class="stringliteral">"command failed\n"</span>); <span class="keywordflow">break</span>;
00492   <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a6">CLI_ERROR_BAD_PARAMETER</a>:
00493     fprintf(pStream, <span class="stringliteral">"bad parameter value\n"</span>); <span class="keywordflow">break</span>;
00494   <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a7">CLI_ERROR_CTX_CREATE</a>:
00495     fprintf(pStream, <span class="stringliteral">"unable to create context\n"</span>); <span class="keywordflow">break</span>;
00496   <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a8">CLI_WARNING_EMPTY_COMMAND</a>:
00497     fprintf(pStream, <span class="stringliteral">"empty command\n"</span>); <span class="keywordflow">break</span>;
00498   <span class="keywordflow">default</span>:
00499     fprintf(pStream, <span class="stringliteral">"unknown error\n"</span>);
00500   }
00501 }
00502 
00503 <span class="comment">// ----- cli_execute_file -------------------------------------------</span>
<a name="l00507"></a><a class="code" href="cli_8c.html#a32">00507</a> <span class="comment"></span><span class="keywordtype">int</span> <a class="code" href="cli_8c.html#a32">cli_execute_file</a>(<a class="code" href="structSCli.html">SCli</a> * pCli, FILE * pStream)
00508 {
00509   <span class="keywordtype">char</span> acLine[1024];
00510   <span class="keywordtype">int</span> iResult;
00511   <span class="keywordtype">int</span> iLen;
00512   uint32_t uLineNumber= 1;
00513   <span class="keywordtype">int</span> iIndex;
00514   <a class="code" href="structSPtrArray.html">STokens</a> * pTokens;
00515 
00516   <span class="keywordflow">while</span> (fgets(acLine, <span class="keyword">sizeof</span>(acLine), pStream) != NULL) {
00517     <span class="comment">// Skip commented lines</span>
00518     <span class="keywordflow">if</span> (acLine[0] != <span class="charliteral">'#'</span>) {
00519       <span class="comment">// Chop '\n' at end of line</span>
00520       iLen= strlen(acLine);
00521       <span class="keywordflow">if</span> ((iLen &gt;= 1) &amp;&amp; (acLine[iLen-1] == <span class="charliteral">'\n'</span>))
00522         acLine[iLen-1]= <span class="charliteral">'\0'</span>;
00523       <span class="comment">// Parse and execute command</span>
00524       iResult= <a class="code" href="cli_8c.html#a29">cli_execute</a>(pCli, acLine);
00525       <span class="keywordflow">if</span> (iResult &lt; 0) {
00526         fprintf(stderr, <span class="stringliteral">"cli-error @line %u: "</span>, uLineNumber);
00527         <a class="code" href="cli_8c.html#a31">cli_perror</a>(stderr, iResult);
00528         fprintf(stderr, <span class="stringliteral">"*** command: \"%s\"\n"</span>, acLine);
00529         <span class="keywordflow">if</span> ((iResult == <a class="code" href="cli_8h.html#a2">CLI_ERROR_UNKNOWN_COMMAND</a>) ||
00530             (iResult == <a class="code" href="cli_8h.html#a3">CLI_ERROR_MISSING_PARAMETER</a>) ||
00531             (iResult == <a class="code" href="cli_8h.html#a6">CLI_ERROR_BAD_PARAMETER</a>)) {
00532           fprintf(stderr, <span class="stringliteral">"*** error  : \""</span>);
00533           pTokens= <a class="code" href="tokenizer_8c.html#a20">tokenizer_get_tokens</a>(pCli-&gt;<a class="code" href="structSCli.html#o0">pTokenizer</a>);
00534           <span class="keywordflow">for</span> (iIndex= 0; iIndex &lt; pCli-&gt;<a class="code" href="structSCli.html#o3">iExecTokenIndex</a>; iIndex++)
00535             fprintf(stderr, <span class="stringliteral">"%s "</span>, <a class="code" href="tokenizer_8c.html#a14">tokens_get_string_at</a>(pTokens, iIndex));
00536           fprintf(stderr, <span class="stringliteral">"^^^\"\n"</span>);
00537           <span class="keywordflow">if</span> ((iResult == <a class="code" href="cli_8h.html#a2">CLI_ERROR_UNKNOWN_COMMAND</a>) &amp;&amp;
00538               (pCli-&gt;<a class="code" href="structSCli.html#o4">pExecCmd</a> != NULL)) {
00539             fprintf(stderr, <span class="stringliteral">"*** expect : "</span>);
00540             <span class="keywordflow">for</span> (iIndex= 0;
00541                  iIndex &lt; <a class="code" href="cli_8c.html#a20">cli_cmd_get_num_subcmds</a>(pCli-&gt;<a class="code" href="structSCli.html#o4">pExecCmd</a>);
00542                  iIndex++) {
00543               <span class="keywordflow">if</span> (iIndex &gt; 0)
00544                 fprintf(stderr, <span class="stringliteral">", "</span>);
00545               fprintf(stderr, <span class="stringliteral">"%s"</span>,
00546                       <a class="code" href="cli_8c.html#a21">cli_cmd_get_subcmd_at</a>(pCli-&gt;<a class="code" href="structSCli.html#o4">pExecCmd</a>, iIndex)-&gt;<a class="code" href="structSCliCmd.html#o0">pcName</a>);
00547             }
00548             fprintf(stderr, <span class="stringliteral">"\n"</span>);
00549           }
00550           <span class="keywordflow">if</span> (((iResult == <a class="code" href="cli_8h.html#a3">CLI_ERROR_MISSING_PARAMETER</a>) ||
00551                (iResult == <a class="code" href="cli_8h.html#a6">CLI_ERROR_BAD_PARAMETER</a>)) &amp;&amp;
00552               (pCli-&gt;<a class="code" href="structSCli.html#o5">pExecParam</a> != NULL))
00553             fprintf(stderr, <span class="stringliteral">"*** expect : %s\n"</span>, pCli-&gt;<a class="code" href="structSCli.html#o5">pExecParam</a>-&gt;<a class="code" href="structSCliCmdParam.html#o0">pcName</a>);
00554         }
00555         <span class="keywordflow">return</span> iResult;
00556       }
00557     }
00558     uLineNumber++;
00559   }
00560   <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a0">CLI_SUCCESS</a>;
00561 }
00562 
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Wed Jul 30 15:56:47 2003 for GDS - Generic Data Structures by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.2 </small></address>
</body>
</html>
