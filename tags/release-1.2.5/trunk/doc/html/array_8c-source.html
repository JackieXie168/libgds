<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>GDS - Generic Data Structures: array.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.2 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Compound&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Compound&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<h1>array.c</h1><a href="array_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">// ==================================================================</span>
00002 <span class="comment">// @(#)array.c</span>
00003 <span class="comment">//</span>
00004 <span class="comment">// @author Bruno Quoitin (bqu@infonet.fundp.ac.be)</span>
00005 <span class="comment">// @date 10/04/2003</span>
00006 <span class="comment">// @lastdate 04/07/2003</span>
00007 <span class="comment">// ==================================================================</span>
00008 
00009 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
00010 <span class="preprocessor">#include &lt;string.h&gt;</span>
00011 
00012 <span class="preprocessor">#include "<a class="code" href="array_8h.html">array.h</a>"</span>
00013 <span class="preprocessor">#include "<a class="code" href="memory_8h.html">memory.h</a>"</span>
00014 
<a name="l00015"></a><a class="code" href="array_8c.html#a0">00015</a> <span class="preprocessor">#define _array_elt_pos(A,i) (((char *) A-&gt;data)+ \</span>
00016 <span class="preprocessor">                            (i)*((SRealArray *) A)-&gt;uEltSize)</span>
<a name="l00017"></a><a class="code" href="array_8c.html#a1">00017</a> <span class="preprocessor"></span><span class="preprocessor">#define _array_size(A) ((SRealArray *) A)-&gt;uEltSize* \</span>
00018 <span class="preprocessor">                       ((SRealArray *) A)-&gt;uLength</span>
00019 <span class="preprocessor"></span>
<a name="l00020"></a><a class="code" href="structSRealArray.html">00020</a> <span class="keyword">typedef</span> <span class="keyword">struct </span>{
<a name="l00021"></a><a class="code" href="structSRealArray.html#o0">00021</a>   uint8_t ** data;
<a name="l00022"></a><a class="code" href="structSRealArray.html#o1">00022</a>   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> uLength;
<a name="l00023"></a><a class="code" href="structSRealArray.html#o2">00023</a>   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> uEltSize;
<a name="l00024"></a><a class="code" href="structSRealArray.html#o3">00024</a>   uint8_t uOptions;
<a name="l00025"></a><a class="code" href="structSRealArray.html#o4">00025</a>   <a class="code" href="array_8h.html#a20">FArrayCompare</a> fCompare;
<a name="l00026"></a><a class="code" href="structSRealArray.html#o5">00026</a>   <a class="code" href="array_8h.html#a21">FArrayDestroy</a> fDestroy;
00027 } <a class="code" href="structSRealArray.html">SRealArray</a>;
00028 
00029 <span class="comment">// ----- _array_compare ---------------------------------------------</span>
<a name="l00037"></a><a class="code" href="array_8c.html#a2">00037</a> <span class="comment"></span><span class="keywordtype">int</span> <a class="code" href="array_8c.html#a2">_array_compare</a>(<span class="keywordtype">void</span> * pItem1, <span class="keywordtype">void</span> * pItem2,
00038                    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> uEltSize)
00039 {
00040   <span class="keywordflow">return</span> memcmp(pItem1, pItem2, uEltSize);
00041 }
00042 
00043 <span class="comment">// ----- _array_create ----------------------------------------------</span>
<a name="l00047"></a><a class="code" href="array_8c.html#a3">00047</a> <span class="comment"></span><a class="code" href="structSArray.html">SArray</a> * <a class="code" href="array_8c.html#a3">_array_create</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> uEltSize, uint8_t uOptions,
00048                        FArrayCompare fCompare,
00049                        FArrayDestroy fDestroy)
00050 {
00051   <a class="code" href="structSRealArray.html">SRealArray</a> * pRealArray= (<a class="code" href="structSRealArray.html">SRealArray</a> *) <a class="code" href="memory_8h.html#a0">MALLOC</a>(<span class="keyword">sizeof</span>(<a class="code" href="structSRealArray.html">SRealArray</a>));
00052   pRealArray-&gt;<a class="code" href="structSRealArray.html#o1">uLength</a>= 0;
00053   pRealArray-&gt;<a class="code" href="structSRealArray.html#o2">uEltSize</a>= uEltSize;
00054   pRealArray-&gt;<a class="code" href="structSRealArray.html#o0">data</a>= NULL;
00055   pRealArray-&gt;<a class="code" href="structSRealArray.html#o3">uOptions</a>= uOptions;
00056   pRealArray-&gt;<a class="code" href="structSRealArray.html#o4">fCompare</a>= fCompare;
00057   pRealArray-&gt;<a class="code" href="structSRealArray.html#o5">fDestroy</a>= fDestroy;
00058   <span class="keywordflow">return</span> (<a class="code" href="structSArray.html">SArray</a> *) pRealArray;
00059 }
00060 
00061 <span class="comment">// ----- _array_destroy ----------------------------------------------</span>
<a name="l00065"></a><a class="code" href="array_8c.html#a4">00065</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="array_8c.html#a4">_array_destroy</a>(<a class="code" href="structSArray.html">SArray</a> ** ppArray)
00066 {
00067   <a class="code" href="structSRealArray.html">SRealArray</a> ** ppRealArray=
00068     (<a class="code" href="structSRealArray.html">SRealArray</a> **) ppArray;
00069   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> uIndex;
00070 
00071   <span class="keywordflow">if</span> (*ppRealArray != NULL) {
00072     <span class="keywordflow">if</span> ((*ppRealArray)-&gt;uLength &gt; 0) {
00073       <span class="keywordflow">if</span> ((*ppRealArray)-&gt;fDestroy != NULL)
00074         <span class="keywordflow">for</span> (uIndex= 0; uIndex &lt; (*ppRealArray)-&gt;uLength; uIndex++)
00075           (*ppRealArray)-&gt;fDestroy(<a class="code" href="array_8c.html#a0">_array_elt_pos</a>((*ppRealArray), uIndex));
00076       <a class="code" href="memory_8h.html#a2">FREE</a>((*ppRealArray)-&gt;data);
00077     }
00078     <a class="code" href="memory_8h.html#a2">FREE</a>(*ppRealArray);
00079     *ppRealArray= NULL;
00080   }
00081 }
00082 
00083 <span class="comment">// ----- _array_resize_if_required ----------------------------------</span>
<a name="l00087"></a><a class="code" href="array_8c.html#a5">00087</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="array_8c.html#a5">_array_resize_if_required</a>(<a class="code" href="structSArray.html">SArray</a> * pArray,
00088                                <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> uNewLength)
00089 {
00090   <a class="code" href="structSRealArray.html">SRealArray</a> * pRealArray= (<a class="code" href="structSRealArray.html">SRealArray</a> *) pArray;
00091 
00092   <span class="keywordflow">if</span> (uNewLength != pRealArray-&gt;<a class="code" href="structSRealArray.html#o1">uLength</a>) {
00093     <span class="keywordflow">if</span> (pRealArray-&gt;<a class="code" href="structSRealArray.html#o1">uLength</a> == 0) {
00094       pRealArray-&gt;<a class="code" href="structSRealArray.html#o0">data</a>=
00095         (uint8_t **) <a class="code" href="memory_8h.html#a0">MALLOC</a>(uNewLength*pRealArray-&gt;<a class="code" href="structSRealArray.html#o2">uEltSize</a>);
00096     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (uNewLength == 0) {
00097       <a class="code" href="memory_8h.html#a2">FREE</a>(pRealArray-&gt;<a class="code" href="structSRealArray.html#o0">data</a>);
00098       pRealArray-&gt;<a class="code" href="structSRealArray.html#o0">data</a>= NULL;
00099     } <span class="keywordflow">else</span> {
00100       pRealArray-&gt;<a class="code" href="structSRealArray.html#o0">data</a>=
00101         (uint8_t **) <a class="code" href="memory_8h.html#a1">REALLOC</a>(pRealArray-&gt;<a class="code" href="structSRealArray.html#o0">data</a>,
00102                              uNewLength*pRealArray-&gt;<a class="code" href="structSRealArray.html#o2">uEltSize</a>);
00103     }
00104     pRealArray-&gt;<a class="code" href="structSRealArray.html#o1">uLength</a>= uNewLength;
00105   }
00106 }
00107 
00108 <span class="comment">// ----- _array_length -----------------------------------------------</span>
<a name="l00112"></a><a class="code" href="array_8c.html#a6">00112</a> <span class="comment"></span><span class="keywordtype">int</span> <a class="code" href="array_8c.html#a6">_array_length</a>(<a class="code" href="structSArray.html">SArray</a> * pArray)
00113 {
00114   <span class="keywordflow">return</span> ((<a class="code" href="structSRealArray.html">SRealArray</a> *) pArray)-&gt;uLength;
00115 }
00116 
00117 <span class="comment">// ----- _array_set_length ------------------------------------------</span>
<a name="l00121"></a><a class="code" href="array_8c.html#a7">00121</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="array_8c.html#a7">_array_set_length</a>(<a class="code" href="structSArray.html">SArray</a> * pArray, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> uNewLength)
00122 {
00123   <a class="code" href="array_8c.html#a5">_array_resize_if_required</a>(pArray, uNewLength);
00124 }
00125 
00126 <span class="comment">// ----- array_set_at -----------------------------------------------</span>
<a name="l00130"></a><a class="code" href="array_8c.html#a8">00130</a> <span class="comment"></span><span class="keywordtype">int</span> <a class="code" href="array_8c.html#a8">_array_set_at</a>(<a class="code" href="structSArray.html">SArray</a> * pArray, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> uIndex, <span class="keywordtype">void</span> * pData)
00131 {
00132   <span class="keywordflow">if</span> (uIndex &gt;= ((<a class="code" href="structSRealArray.html">SRealArray</a> *) pArray)-&gt;uLength)
00133     <span class="keywordflow">return</span> -1;
00134   memcpy(<a class="code" href="array_8c.html#a0">_array_elt_pos</a>(pArray, uIndex), pData,
00135          ((<a class="code" href="structSRealArray.html">SRealArray</a> *) pArray)-&gt;uEltSize);
00136   <span class="keywordflow">return</span> 0;
00137 }
00138 
00139 <span class="comment">// ----- array_get_at -----------------------------------------------</span>
<a name="l00143"></a><a class="code" href="array_8c.html#a9">00143</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="array_8c.html#a9">_array_get_at</a>(<a class="code" href="structSArray.html">SArray</a> * pArray, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> uIndex, <span class="keywordtype">void</span> * pData)
00144 {
00145   memcpy(pData, <a class="code" href="array_8c.html#a0">_array_elt_pos</a>(pArray, uIndex),
00146          ((<a class="code" href="structSRealArray.html">SRealArray</a> *) pArray)-&gt;uEltSize);
00147 }
00148 
00149 <span class="comment">// ----- _array_sorted_find_index -----------------------------------</span>
<a name="l00154"></a><a class="code" href="array_8c.html#a10">00154</a> <span class="comment"></span><span class="keywordtype">int</span> <a class="code" href="array_8c.html#a10">_array_sorted_find_index</a>(<a class="code" href="structSArray.html">SArray</a> * pArray, <span class="keywordtype">void</span> * pData,
00155                              <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> * puIndex)
00156 {
00157   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> uOffset= 0;
00158   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> uSize= ((<a class="code" href="structSRealArray.html">SRealArray</a> *) pArray)-&gt;uLength;
00159   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> uPos= uSize/2;
00160   <span class="keywordtype">int</span> iCompareResult;
00161 
00162   <span class="keywordflow">while</span> (uSize &gt; 0) {
00163     iCompareResult=
00164       (((<a class="code" href="structSRealArray.html">SRealArray</a> *) pArray)-&gt;fCompare(<a class="code" href="array_8c.html#a0">_array_elt_pos</a>(pArray, uPos), pData,
00165                                          ((<a class="code" href="structSRealArray.html">SRealArray</a> *) pArray)-&gt;uEltSize));
00166     <span class="keywordflow">if</span> (!iCompareResult) {
00167       *puIndex= uPos;
00168       <span class="keywordflow">return</span> 0;
00169     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (iCompareResult &gt; 0) {
00170       <span class="keywordflow">if</span> (uPos &gt; uOffset) {
00171         uSize= uPos-uOffset;
00172         uPos= uOffset+uSize/2;
00173       } <span class="keywordflow">else</span>
00174         <span class="keywordflow">break</span>;
00175     } <span class="keywordflow">else</span> {
00176       <span class="keywordflow">if</span> (uOffset+uSize-uPos &gt; 0) {
00177         uSize= uOffset+uSize-uPos-1;
00178         uOffset= uPos+1;
00179         uPos= uOffset+uSize/2;
00180       } <span class="keywordflow">else</span>
00181         <span class="keywordflow">break</span>;
00182     }
00183   }
00184   *puIndex= uPos;
00185   <span class="keywordflow">return</span> -1;
00186 }
00187 
00188 <span class="comment">// ----- _array_insert_at -------------------------------------------</span>
<a name="l00192"></a><a class="code" href="array_8c.html#a11">00192</a> <span class="comment"></span><span class="keywordtype">int</span> <a class="code" href="array_8c.html#a11">_array_insert_at</a>(<a class="code" href="structSArray.html">SArray</a> * pArray, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> uIndex, <span class="keywordtype">void</span> * pData)
00193 {
00194   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> uOffset;
00195   <a class="code" href="structSRealArray.html">SRealArray</a> * pRealArray= (<a class="code" href="structSRealArray.html">SRealArray</a> *) pArray;
00196 
00197   <span class="keywordflow">if</span> (uIndex &gt; ((<a class="code" href="structSRealArray.html">SRealArray</a> *) pArray)-&gt;uLength)
00198     <span class="keywordflow">return</span> -1;
00199   <a class="code" href="array_8c.html#a5">_array_resize_if_required</a>(pArray, ((<a class="code" href="structSRealArray.html">SRealArray</a> *) pArray)-&gt;uLength+1);
00200   <span class="keywordflow">for</span> (uOffset= pRealArray-&gt;<a class="code" href="structSRealArray.html#o1">uLength</a>-1; uOffset &gt; uIndex; uOffset--) {
00201     memcpy(<a class="code" href="array_8c.html#a0">_array_elt_pos</a>(pArray, uOffset),
00202            <a class="code" href="array_8c.html#a0">_array_elt_pos</a>(pArray, uOffset-1),
00203            pRealArray-&gt;<a class="code" href="structSRealArray.html#o2">uEltSize</a>);
00204   }
00205   <span class="keywordflow">return</span> <a class="code" href="array_8c.html#a8">_array_set_at</a>(pArray, uIndex, pData);
00206 }
00207 
00208 <span class="comment">// ----- _array_add -------------------------------------------------</span>
<a name="l00212"></a><a class="code" href="array_8c.html#a12">00212</a> <span class="comment"></span><span class="keywordtype">int</span> <a class="code" href="array_8c.html#a12">_array_add</a>(<a class="code" href="structSArray.html">SArray</a> * pArray, <span class="keywordtype">void</span> * pData)
00213 {
00214   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> uIndex;
00215 
00216   <span class="keywordflow">if</span> (((<a class="code" href="structSRealArray.html">SRealArray</a> *) pArray)-&gt;uOptions &amp; <a class="code" href="array_8h.html#a0">ARRAY_OPTION_SORTED</a>) {
00217     <span class="keywordflow">if</span> (<a class="code" href="array_8c.html#a10">_array_sorted_find_index</a>(pArray, pData, &amp;uIndex) &lt; 0)
00218       <span class="keywordflow">return</span> <a class="code" href="array_8c.html#a11">_array_insert_at</a>(pArray, uIndex, pData);
00219     <span class="keywordflow">else</span>
00220       <span class="keywordflow">return</span> <a class="code" href="array_8c.html#a8">_array_set_at</a>(pArray, uIndex, pData);
00221   } <span class="keywordflow">else</span>
00222     <span class="keywordflow">return</span> <a class="code" href="array_8c.html#a13">_array_append</a>(pArray, pData);
00223 }
00224 
00225 <span class="comment">// ----- array_append -----------------------------------------------</span>
<a name="l00229"></a><a class="code" href="array_8c.html#a13">00229</a> <span class="comment"></span><span class="keywordtype">int</span> <a class="code" href="array_8c.html#a13">_array_append</a>(<a class="code" href="structSArray.html">SArray</a> * pArray, <span class="keywordtype">void</span> * pData)
00230 {
00231   <a class="code" href="array_8c.html#a5">_array_resize_if_required</a>(pArray, ((<a class="code" href="structSRealArray.html">SRealArray</a> *) pArray)-&gt;uLength+1);
00232 
00233   <a class="code" href="array_8c.html#a8">_array_set_at</a>(pArray, ((<a class="code" href="structSRealArray.html">SRealArray</a> *) pArray)-&gt;uLength-1, pData);
00234   <span class="keywordflow">return</span> 0;
00235 }
00236 
00237 <span class="comment">// ----- _array_copy ------------------------------------------------</span>
<a name="l00241"></a><a class="code" href="array_8c.html#a14">00241</a> <span class="comment"></span><a class="code" href="structSArray.html">SArray</a> * <a class="code" href="array_8c.html#a14">_array_copy</a>(<a class="code" href="structSArray.html">SArray</a> * pArray)
00242 {
00243   <a class="code" href="structSArray.html">SArray</a> * pNewArray= <a class="code" href="array_8c.html#a3">_array_create</a>(((<a class="code" href="structSRealArray.html">SRealArray</a> *) pArray)-&gt;uEltSize,
00244                                     ((<a class="code" href="structSRealArray.html">SRealArray</a> *) pArray)-&gt;uOptions,
00245                                     ((<a class="code" href="structSRealArray.html">SRealArray</a> *) pArray)-&gt;fCompare,
00246                                     ((<a class="code" href="structSRealArray.html">SRealArray</a> *) pArray)-&gt;fDestroy);
00247   <a class="code" href="array_8c.html#a7">_array_set_length</a>(pNewArray, ((<a class="code" href="structSRealArray.html">SRealArray</a> *)pArray)-&gt;uLength);
00248   memcpy(pNewArray-&gt;<a class="code" href="structSArray.html#o0">data</a>, pArray-&gt;<a class="code" href="structSArray.html#o0">data</a>, <a class="code" href="array_8c.html#a1">_array_size</a>(pArray));
00249   <span class="keywordflow">return</span> pNewArray;
00250 }
00251 
00252 <span class="comment">// ----- _array_remove_at -------------------------------------------</span>
<a name="l00256"></a><a class="code" href="array_8c.html#a15">00256</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="array_8c.html#a15">_array_remove_at</a>(<a class="code" href="structSArray.html">SArray</a> * pArray, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> uIndex)
00257 {
00258   <a class="code" href="structSRealArray.html">SRealArray</a> * pRealArray= (<a class="code" href="structSRealArray.html">SRealArray</a> *) pArray;
00259   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> uOffset;
00260 
00261   <span class="comment">// Free item at given position if required</span>
00262   <span class="keywordflow">if</span> (pRealArray-&gt;<a class="code" href="structSRealArray.html#o5">fDestroy</a> != NULL)
00263     pRealArray-&gt;<a class="code" href="structSRealArray.html#o5">fDestroy</a>(<a class="code" href="array_8c.html#a0">_array_elt_pos</a>(pRealArray, uIndex));
00264 
00265   <span class="keywordflow">if</span> (uIndex &lt; pRealArray-&gt;<a class="code" href="structSRealArray.html#o1">uLength</a>) {
00266     <span class="comment">// Since (uIndex &gt;= 0), then (pRealArray-&gt;uLength &gt;= 1) and then</span>
00267     <span class="comment">// there is no problem with the unsigned variable uOffset.</span>
00268     <span class="keywordflow">for</span> (uOffset= uIndex; uOffset &lt; pRealArray-&gt;<a class="code" href="structSRealArray.html#o1">uLength</a>-1; uOffset++) {
00269       memcpy(<a class="code" href="array_8c.html#a0">_array_elt_pos</a>(pArray, uOffset),
00270              <a class="code" href="array_8c.html#a0">_array_elt_pos</a>(pArray, uOffset+1),
00271              pRealArray-&gt;<a class="code" href="structSRealArray.html#o2">uEltSize</a>);
00272     }
00273     <a class="code" href="array_8c.html#a5">_array_resize_if_required</a>(pArray, pRealArray-&gt;<a class="code" href="structSRealArray.html#o1">uLength</a>-1);
00274   }
00275 }
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Wed Jul 30 15:56:47 2003 for GDS - Generic Data Structures by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.2 </small></address>
</body>
</html>
